; -*- Mode:LISP; Base:8 -*-

;	** (c) Copyright 1980 Massachusetts Institute of Technology **

;ELEMENTS IN Q-CORRESPONDING-VARIABLE-LIST ARE SYMBOLS WHOSE VALUES IN MACLISP ARE LISTS
;  ALL OF WHOSE MEMBERS ARE SYSTEM CONTANTS.  THESE SYSTEM CONSTANTS HAVE MACLISP VALUES
;  AND ARE MADE TO HAVE THE IDENTICAL VALUES IN LISP MACHINE LISP.
(SETQ Q-CORRESPONDING-VARIABLE-LISTS '(AREA-LIST Q-CDR-CODES Q-DATA-TYPES Q-HEADER-TYPES
   Q-LISP-CONSTANTS
   ;RTB-RTB-BITS RTB-RTS-BITS RTB-RTO-OPS 
   ;RTB-MISC RTM-OPS READTABLE-%%-BITS 
   ARRAY-TYPES HEADER-FIELDS MISC-Q-VARIABLES 
   ARG-DESC-FIELDS NUMERIC-ARG-DESC-FIELDS FEF-NAME-PRESENT FEF-SPECIALNESS
   FEF-ARG-SYNTAX FEF-INIT-OPTION FEFHI-FIELDS FEF-DES-DT FEF-QUOTE-STATUS 
   FEF-FUNCTIONAL 
   ARRAY-FIELDS ARRAY-LEADER-FIELDS ARRAY-MISCS Q-REGION-BITS SELF-REF-POINTER-FIELDS
   SYSTEM-CONSTANT-LISTS SYSTEM-VARIABLE-LISTS
   SCRATCH-PAD-VARIABLES FASL-GROUP-FIELDS FASL-OPS 
   FASL-TABLE-PARAMETERS FASL-CONSTANTS FASL-CONSTANT-LISTS FEFH-CONSTANTS 
   FEFHI-INDEXES  
   STACK-GROUP-HEAD-LEADER-QS SG-STATES SPECIAL-PDL-LEADER-QS REG-PDL-LEADER-QS 
   SG-STATE-FIELDS SG-INST-DISPATCHES
   SYSTEM-COMMUNICATION-AREA-QS PAGE-HASH-TABLE-FIELDS 
   Q-FIELDS MICRO-STACK-FIELDS M-FLAGS-FIELDS M-ERROR-SUBSTATUS-FIELDS 
   SPECPDL-FIELDS LINEAR-PDL-FIELDS LINEAR-PDL-QS HARDWARE-MEMORY-SIZES 
   DISK-RQ-LEADER-QS DISK-RQ-HWDS DISK-HARDWARE-SYMBOLS UNIBUS-CHANNEL-QS UNIBUS-CSR-BITS
   CHAOS-BUFFER-LEADER-QS CHAOS-HARDWARE-SYMBOLS INSTANCE-DESCRIPTOR-OFFSETS
   METER-EVENTS METER-ENABLES
   ADI-KINDS ADI-STORING-OPTIONS ADI-FIELDS))

;ELEMENTS IN SYSTEM-CONSTANT-LISTS ARE SYMBOLS WHOSE MACLISP AND LISP MACHINE
;VALUES ARE LISTS OF SYMBOLS WHICH SHOULD GET SYSTEM-CONSTANT PROPERTY FOR THE COMPILER.
;NORMALLY SHOULD BE VERY CLOSE TO Q-CORRESPONDING-VARIABLES-LISTS
(SETQ SYSTEM-CONSTANT-LISTS '(AREA-LIST Q-CDR-CODES Q-DATA-TYPES Q-HEADER-TYPES
   Q-LISP-CONSTANTS
   ;RTB-RTB-BITS RTB-RTS-BITS RTB-RTO-OPS
   ;RTB-MISC RTM-OPS READTABLE-%%-BITS
   ARRAY-TYPES HEADER-FIELDS ;NOT HEADER-TYPES
   ARG-DESC-FIELDS NUMERIC-ARG-DESC-FIELDS FEF-NAME-PRESENT FEF-SPECIALNESS
   FEF-ARG-SYNTAX FEF-INIT-OPTION FEFHI-FIELDS FEF-DES-DT FEF-QUOTE-STATUS 
   FEF-FUNCTIONAL 
   ARRAY-FIELDS ARRAY-LEADER-FIELDS Q-REGION-BITS SELF-REF-POINTER-FIELDS
   ARRAY-MISCS ;ARRAY-MISCS SHOULD BE FLUSHED SOMEDAY
   SYSTEM-CONSTANT-LISTS SYSTEM-VARIABLE-LISTS ;SOME THINGS LOOK AT SUBLISTS OF THESE
   ;NOT SCRATCH-PAD-VARIABLES
   ;NOT SCRATCH-PAD-POINTERS SCRATCH-PAD-PARAMETERS SCRATCH-PAD-TEMPS 
   FASL-GROUP-FIELDS FASL-OPS
   FASL-TABLE-PARAMETERS FASL-CONSTANTS FASL-CONSTANT-LISTS FEFH-CONSTANTS
   FEFHI-INDEXES 
   STACK-GROUP-HEAD-LEADER-QS SG-STATES SPECIAL-PDL-LEADER-QS REG-PDL-LEADER-QS 
   SG-STATE-FIELDS SG-INST-DISPATCHES
   SYSTEM-COMMUNICATION-AREA-QS PAGE-HASH-TABLE-FIELDS
   Q-FIELDS MICRO-STACK-FIELDS M-FLAGS-FIELDS M-ERROR-SUBSTATUS-FIELDS 
   SPECPDL-FIELDS LINEAR-PDL-FIELDS LINEAR-PDL-QS HARDWARE-MEMORY-SIZES 
   DISK-RQ-LEADER-QS DISK-RQ-HWDS DISK-HARDWARE-SYMBOLS UNIBUS-CHANNEL-QS UNIBUS-CSR-BITS
   CHAOS-BUFFER-LEADER-QS CHAOS-HARDWARE-SYMBOLS INSTANCE-DESCRIPTOR-OFFSETS
   METER-EVENTS METER-ENABLES A-MEMORY-ARRAY-SYMBOLS
   ADI-KINDS ADI-STORING-OPTIONS ADI-FIELDS))

;LIKE ABOVE BUT GET DECLARED SPECIAL RATHER THAN SYSTEM-CONSTANT
(SETQ SYSTEM-VARIABLE-LISTS '(
	A-MEMORY-LOCATION-NAMES M-MEMORY-LOCATION-NAMES 
	IO-STREAM-NAMES LISP-VARIABLES MISC-Q-VARIABLES
))

(SETQ IO-STREAM-NAMES '(
	STANDARD-INPUT STANDARD-OUTPUT ERROR-OUTPUT QUERY-IO TERMINAL-IO TRACE-OUTPUT
))

;These get declared special, and get their Maclisp values shipped over
(SETQ MISC-Q-VARIABLES '(SYSTEM-CONSTANT-LISTS SYSTEM-VARIABLE-LISTS PRIN1 FOR-CADR
			 COLD-INITIALIZATION-LIST BEFORE-COLD-INITIALIZATION-LIST
			 WARM-INITIALIZATION-LIST
                         ONCE-ONLY-INITIALIZATION-LIST SYSTEM-INITIALIZATION-LIST))

;These get declared special, but don't get sent over.  They get initialized
; some other way, e.g. from a load-time-setq in some compile list, or from special
; code in COLD, or by LISP-REINITIALIZE when the machine is first started.
(SETQ LISP-VARIABLES '(BASE IBASE PRINLENGTH PRINLEVEL *NOPOINT *RSET FASLOAD
		       EVALHOOK PACKAGE READTABLE + - *
		       USER-ID LISP-CRASH-LIST SCHEDULER-STACK-GROUP
		       RUBOUT-HANDLER LOCAL-DECLARATIONS STREAM-INPUT-OPERATIONS
		       STREAM-OUTPUT-OPERATIONS %INITIALLY-DISABLE-TRAPPING))

;These get declared SYSTEM-CONSTANT (which is similar to SPECIAL) and get their
; Maclisp values shipped over.
(SETQ Q-LISP-CONSTANTS '( PAGE-SIZE SIZE-OF-OB-TBL AREA-LIST Q-DATA-TYPES
			  SIZE-OF-AREA-ARRAYS LENGTH-OF-ATOM-HEAD 
			  %ADDRESS-SPACE-MAP-BYTE-SIZE %ADDRESS-SPACE-QUANTUM-SIZE
			  ARRAY-ELEMENTS-PER-Q ARRAY-BITS-PER-ELEMENT %FEF-HEADER-LENGTH
			  LAMBDA-LIST-KEYWORDS %LP-CALL-BLOCK-LENGTH 
			  %LP-INITIAL-LOCAL-BLOCK-OFFSET A-MEMORY-COUNTER-BLOCK-NAMES))

(SETQ HARDWARE-MEMORY-SIZES '(
	SIZE-OF-HARDWARE-CONTROL-MEMORY SIZE-OF-HARDWARE-DISPATCH-MEMORY 
	SIZE-OF-HARDWARE-A-MEMORY SIZE-OF-HARDWARE-M-MEMORY 
	SIZE-OF-HARDWARE-PDL-BUFFER SIZE-OF-HARDWARE-MICRO-STACK 
	SIZE-OF-HARDWARE-LEVEL-1-MAP SIZE-OF-HARDWARE-LEVEL-2-MAP 
	SIZE-OF-HARDWARE-UNIBUS-MAP ))

(SETQ LAMBDA-LIST-KEYWORDS '(&OPTIONAL &REST &AUX
			     &SPECIAL &LOCAL
			     &FUNCTIONAL
			     &EVAL &QUOTE &QUOTE-DONTCARE 
			     &DT-DONTCARE &DT-NUMBER &DT-FIXNUM &DT-SYMBOL &DT-ATOM 
			     &DT-LIST &DT-FRAME
			     &FUNCTION-CELL
			     &LIST-OF &BODY	;for DEFMACRO
			     &KEY &ALLOW-OTHER-KEYS
			     ))

;;; Data on how to set up the initial areas in the cold load.

;See also AREA-LIST, which is in QCOM because microassembly refers to it.

 ;THESE AREAS ARE ENCACHED IN THE PDL BUFFER.
(SETQ PDL-BUFFER-AREA-LIST '(
	LINEAR-PDL-AREA				;MAIN PDL
	PDL-AREA				;PDLS FOR MISC STACK GROUPS
))

 ;NOTE THAT AT PRESENT ALL AREAS UP THROUGH ADDRESS-SPACE-MAP MUST BE WIRED.
 ;THE REASON IS THAT WHEN THE MICROCODE STARTS UP IT STRAIGHT-MAPS THAT
 ;AMOUNT OF VIRTUAL MEMORY, WITHOUT CHECKING SEPARATELY FOR EACH PAGE.
 ;IT WOULD LOSE BIG IF ONE OF THOSE STRAIGHT-MAPPED PAGES GOT SWAPPED OUT.
 ;EXCEPT, UNUSED PORTIONS OF PAGE-TABLE-AREA AND PHYSICAL-PAGE-DATA GET UNWIRED
(SETQ WIRED-AREA-LIST '(			;AREAS THAT MAY NOT BE MOVED NOR SWAPPED OUT
	RESIDENT-SYMBOL-AREA			;NO GOOD REASON
	SYSTEM-COMMUNICATION-AREA		;FOR CONSOLE, PDP10, MICRO INTERRUPT, ETC.
	SCRATCH-PAD-INIT-AREA			;LOAD MICRO CODE VARIABLES UPON STARTUP
	MICRO-CODE-SYMBOL-AREA			;NO GOOD REASON, ACTUALLY
	REGION-ORIGIN				;USED BY PAGE FAULT HANDLER
	REGION-LENGTH				;USED BY PAGE FAULT HANDLER
	REGION-BITS				;USED BY PAGE FAULT HANDLER
	REGION-FREE-POINTER			;Used by DISK-SAVE, etc. Not likely to
						; be swapped out!
	PAGE-TABLE-AREA				;USED BY PAGE FAULT HANDLER
	PHYSICAL-PAGE-DATA			;USED BY PAGE FAULT HANDLER
	ADDRESS-SPACE-MAP			;USED BY PAGE FAULT HANDLER
))

;THIS LIST ISN'T NECESSARILY UP TO DATE.  FEATURE ISN'T REALLY USED YET.
(SETQ READ-ONLY-AREA-LIST '(			;AREAS TO BE SET UP READ ONLY BY COLD LOAD
	SCRATCH-PAD-INIT-AREA
	MICRO-CODE-SYMBOL-AREA
	SUPPORT-ENTRY-VECTOR
	CONSTANTS-AREA
	INIT-LIST-AREA
	MICRO-CODE-SYMBOL-NAME-AREA
))

;COLD-LOAD-AREA-SIZES is in QCOM, since writing out a microassembly refers to it.

(SETQ COLD-LOAD-REGION-SIZES			;DEFAULT REGION SIZE IS 16K
      '(WORKING-STORAGE-AREA 1000000 MACRO-COMPILED-PROGRAM 400000
	P-N-STRING 400000 NR-SYM 200000 FASL-CONSTANTS-AREA 400000
	PDL-AREA 200000
	PROPERTY-LIST-AREA 200000 PERMANENT-STORAGE-AREA 400000))

;In the cold-load, areas have only one region, so you can only use one
;representation type per area.  These are the list areas, the rest are structure areas.
(SETQ LIST-STRUCTURED-AREAS '(
	SYSTEM-COMMUNICATION-AREA SCRATCH-PAD-INIT-AREA MICRO-CODE-SYMBOL-AREA
	PAGE-TABLE-AREA PHYSICAL-PAGE-DATA REGION-ORIGIN REGION-LENGTH
	REGION-BITS REGION-FREE-POINTER REGION-GC-POINTER
	REGION-LIST-THREAD AREA-NAME AREA-REGION-LIST AREA-REGION-SIZE
	AREA-REGION-BITS AREA-MAXIMUM-SIZE  
	SUPPORT-ENTRY-VECTOR CONSTANTS-AREA
	MICRO-CODE-ENTRY-AREA MICRO-CODE-ENTRY-NAME-AREA
	MICRO-CODE-ENTRY-ARGS-INFO-AREA MICRO-CODE-ENTRY-MAX-PDL-USAGE
	MICRO-CODE-ENTRY-ARGLIST-AREA
	MICRO-CODE-SYMBOL-NAME-AREA INIT-LIST-AREA PROPERTY-LIST-AREA
	OBT-TAILS FASL-CONSTANTS-AREA
))

(SETQ STATIC-AREAS '(	;not including Fixed areas
	INIT-LIST-AREA PERMANENT-STORAGE-AREA P-N-STRING CONTROL-TABLES
	NR-SYM MACRO-COMPILED-PROGRAM 
	FASL-TABLE-AREA FASL-TEMP-AREA FASL-CONSTANTS-AREA
))

;Don't put FUNCTION around the symbols in here -- that means if you
;redefine the function the microcode does not get the new definition,
;which is not what you normally want.  Saying FUNCTION makes it a couple
;microseconds faster to call it.  Not all of these data are actually
;used; check the microcode if you want to know.
(SETQ SUPPORT-VECTOR-CONTENTS '((QUOTE PRINT) (QUOTE CALL-NAMED-STRUCTURE)
				(QUOTE DEFSTRUCT-DESCRIPTION)
				(QUOTE APPLY-LAMBDA) (QUOTE EQUAL) (QUOTE PACKAGE)
				(QUOTE EXPT-HARD) (QUOTE NUMERIC-ONE-ARGUMENT)
				(QUOTE NUMERIC-TWO-ARGUMENTS) (QUOTE "unbound")
				(QUOTE INSTANCE-HASH-FAILURE)
				(QUOTE INSTANCE-INVOKE-VECTOR)
				(QUOTE EQUALP)
				(QUOTE EQUALP-ARRAY)))

(SETQ CONSTANTS-PAGE '(NIL T 0 1 2 3 4 5 6 7 8 9 10. -1 -2 -3 -4))		;CONTENTS OF CONSTANTS PAGE

(SETQ SCRATCH-PAD-VARIABLES '(SCRATCH-PAD-POINTERS SCRATCH-PAD-PARAMETER-OFFSET 
  SCRATCH-PAD-PARAMETERS SCRATCH-PAD-TEMP-OFFSET SCRATCH-PAD-TEMPS))

(SETQ SCRATCH-PAD-POINTERS '(INITIAL-TOP-LEVEL-FUNCTION ERROR-HANDLER-STACK-GROUP 
	CURRENT-STACK-GROUP INITIAL-STACK-GROUP	LAST-ARRAY-ELEMENT-ACCESSED))

(SETQ SCRATCH-PAD-PARAMETER-OFFSET 20)

(COND ((> (LENGTH SCRATCH-PAD-POINTERS) SCRATCH-PAD-PARAMETER-OFFSET) 
	(BARF 'BARF 'SCRACH-PAD-PARAMETER-OFFSET 'BARF)))

(SETQ SCRATCH-PAD-PARAMETERS '(ERROR-TRAP-IN-PROGRESS DEFAULT-CONS-AREA 
	BIND-CONS-AREA LAST-ARRAY-ACCESSED-TYPE LAST-ARRAY-ACCESSED-INDEX 
	INVOKE-MODE INVISIBLE-MODE 
	CDR-ATOM-MODE CAR-ATOM-MODE ACTIVE-MICRO-CODE-ENTRIES))

(SETQ SCRATCH-PAD-TEMP-OFFSET 20)

(COND ((> (LENGTH SCRATCH-PAD-PARAMETERS) SCRATCH-PAD-TEMP-OFFSET)
	(BARF 'BARF 'SCRATCH-PAD-TEMP-OFFSET 'BARF)))

(SETQ SCRATCH-PAD-TEMPS '(LAST-INSTRUCTION TEMP-TRAP-CODE LOCAL-BLOCK-OFFSET 
	SCRATCH-/#-ARGS-LOADED TEMP-PC SPECIALS-IN-LAST-BLOCK-SLOW-ENTERED))

;; No initial initializations
;; These variables must be initialized to NIL
;; BEFORE the first fasl file is loaded.
(SETQ COLD-INITIALIZATION-LIST NIL BEFORE-COLD-INITIALIZATION-LIST NIL
      WARM-INITIALIZATION-LIST NIL
      ONCE-ONLY-INITIALIZATION-LIST NIL SYSTEM-INITIALIZATION-LIST NIL)

;;; The documentation that used to be here has been moved to LMDOC;FASLD >

(SPECIAL FASL-TABLE FASL-GROUP-LENGTH FASL-GROUP-FLAG FASL-RETURN-FLAG)

(SETQ FASL-GROUP-FIELD-VALUES '(%FASL-GROUP-CHECK 100000 
   %FASL-GROUP-FLAG 40000 %FASL-GROUP-LENGTH 37700 
   FASL-GROUP-LENGTH-SHIFT -6 %FASL-GROUP-TYPE 77 
  %%FASL-GROUP-CHECK 2001 %%FASL-GROUP-FLAG 1701 %%FASL-GROUP-LENGTH 0610 
  %%FASL-GROUP-TYPE 0006))

(SETQ FASL-GROUP-FIELDS (GET-ALTERNATE FASL-GROUP-FIELD-VALUES))
(ASSIGN-ALTERNATE FASL-GROUP-FIELD-VALUES)

(SETQ FASL-OPS '(FASL-OP-ERR FASL-OP-NOOP FASL-OP-INDEX FASL-OP-SYMBOL FASL-OP-LIST 
  FASL-OP-TEMP-LIST FASL-OP-FIXED FASL-OP-FLOAT 
  FASL-OP-ARRAY FASL-OP-EVAL FASL-OP-MOVE 
  FASL-OP-FRAME FASL-OP-LIST-COMPONENT FASL-OP-ARRAY-PUSH FASL-OP-STOREIN-SYMBOL-VALUE 
  FASL-OP-STOREIN-FUNCTION-CELL FASL-OP-STOREIN-PROPERTY-CELL 
  FASL-OP-FETCH-SYMBOL-VALUE FASL-OP-FETCH-FUNCTION-CELL 
  FASL-OP-FETCH-PROPERTY-CELL FASL-OP-APPLY FASL-OP-END-OF-WHACK 
  FASL-OP-END-OF-FILE FASL-OP-SOAK FASL-OP-FUNCTION-HEADER FASL-OP-FUNCTION-END 
  FASL-OP-NULL-ARRAY-ELEMENT FASL-OP-UNUSED9 FASL-OP-UNUSED10 
  FASL-OP-UNUSED11 FASL-OP-UNUSED12 FASL-OP-QUOTE-POINTER FASL-OP-S-V-CELL 
  FASL-OP-FUNCELL FASL-OP-CONST-PAGE FASL-OP-SET-PARAMETER FASL-OP-INITIALIZE-ARRAY 
  FASL-OP-CHARACTER FASL-OP-UNUSED1 FASL-OP-UNUSED2 
  FASL-OP-UNUSED3 FASL-OP-UNUSED4 FASL-OP-UNUSED5  
  FASL-OP-UNUSED6 FASL-OP-STRING FASL-OP-STOREIN-ARRAY-LEADER 
  FASL-OP-INITIALIZE-NUMERIC-ARRAY FASL-OP-REMOTE-VARIABLE FASL-OP-PACKAGE-SYMBOL
  FASL-OP-EVAL1 FASL-OP-FILE-PROPERTY-LIST FASL-OP-REL-FILE FASL-OP-RATIONAL
  FASL-OP-COMPLEX FASL-OP-LARGE-INDEX FASL-OP-STOREIN-SYMBOL-CELL
))
(ASSIGN-VALUES FASL-OPS 0)

(SETQ FASL-TABLE-PARAMETERS '(FASL-NIL FASL-EVALED-VALUE FASL-TEM1 FASL-TEM2 FASL-TEM3 
    FASL-SYMBOL-HEAD-AREA 
    FASL-SYMBOL-STRING-AREA FASL-OBARRAY-POINTER FASL-ARRAY-AREA 
    FASL-FRAME-AREA FASL-LIST-AREA FASL-TEMP-LIST-AREA 
    FASL-UNUSED FASL-UNUSED2 FASL-UNUSED3 
    FASL-UNUSED6 FASL-UNUSED4 FASL-UNUSED5))
(ASSIGN-VALUES FASL-TABLE-PARAMETERS 0)

(SETQ FASL-CONSTANTS '(LENGTH-OF-FASL-TABLE FASL-TABLE-WORKING-OFFSET))

(SETQ FASL-CONSTANT-LISTS '(FASL-GROUP-FIELDS FASL-OPS FASL-TABLE-PARAMETERS 
    FASL-CONSTANTS))

(SETQ FASL-TABLE-WORKING-OFFSET 40)

(COND ((> (LENGTH FASL-TABLE-PARAMETERS) FASL-TABLE-WORKING-OFFSET)
	(IOC V)
	(PRINT 'FASL-TABLE-PARAMETER-OVERFLOW)))

;PEOPLE CALL THIS YOU KNOW, DON'T GO RANDOMLY DELETING IT!
(DEFUN FASL-ASSIGN-VARIABLE-VALUES NIL 
 ())  ;I GUESS WHAT THIS USED TO DO IS DONE AT TOP LEVEL IN THIS FILE
