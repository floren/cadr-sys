;;; -*- Mode: Lisp; Package: FILE-SYSTEM; Base: 8.; Patch-File: T -*-
;;; Patch file for Local-File version 48.1
;;; Reason: Allow rewrite of root dir when disk space scarce.
;;; Written 1/04/84 18:03:45 by LMFile,
;;; while running on Lisp Machine Filecomputer from band 1
;;; with System 98.22, CADR 3.4, ZMail 53.9, MIT-Specific 22.0, Experimental Local-File 48.0, Experimental FILE-Server 8.0, Experimental LFS 3.0, Experimental MagTape 22.0, microcode 306, Xmntl FS.



; From file FSGUTS.LISP SRC:<L.FILE> OZ:
#8R FILE-SYSTEM#:
(COMPILER-LET ((PACKAGE (PKG-FIND-PACKAGE "FILE-SYSTEM")))
  (COMPILER#:PATCH-SOURCE-FILE "SYS: FILE; FSGUTS  "

(DEFUN GET-OLD-ROOT-DIRECTORY-MAP (ROOT-DIRECTORY)
  (LET ((WRITING-INTERNAL-STRUCTURES T))
    (WITH-MAP-STREAM-OUT (STREAM)
      (PUT-BYTES STREAM 3 DMM-CHECK)
      (DOLIST (DIRECTORY (DIRECTORY-FILES ROOT-DIRECTORY))
	(WRITE-OLD-DIRECTORY-ENTRY STREAM DIRECTORY)))))

))
