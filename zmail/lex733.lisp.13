;;; RFC733 lexer FSM definition -*- Mode:LISP; Package:ZWEI; Base:8 -*-
;;; ** (c) Copyright 1981 Massachusetts Institute of Technology **

(DECLARE (FERROR NIL "If you are compiling this, and not using RTC, you are losing"))

(SI:MAC OPEN #/(
	CLOSE #/)
	LEFT-BRACKET #/<
	RIGHT-BRACKET #/>
;	PERIOD #/.
	ATSIGN #/@
	PERCENT #/%
	COMMA #/,
	SEMI #/;
	COLON #/:
	BACKSLASH #/\
	QUOTE-START-CHAR #/"
	AS '(// #/A #/a)
	TS '(// #/T #/t)
	SPECIAL-CHAR (LIST '// OPEN CLOSE LEFT-BRACKET RIGHT-BRACKET ATSIGN COMMA SEMI COLON
;			   PERIOD
			   PERCENT QUOTE-START-CHAR #/[ #/])
	EOF-CHAR -1
	SLASHIFIED-CHAR -2
	LWSP-CHAR '(// #\SP #\TAB)
	WHITE-SPACE-CHAR `(// #\CR ,@(CDR LWSP-CHAR))
	BREAK `(// ,@(CDR WHITE-SPACE-CHAR)
		   ,@(CDR SPECIAL-CHAR)
		   ,EOF-CHAR)
	ANY (CONS '// (DO ((I -2 (1+ I))
			   (X NIL (CONS I X)))
			  ((= I SI:RDTBL-ARRAY-SIZE) X))))

(SI:DEF LEFT-BRACKET
	LEFT-BRACKET
	SINGLE)

(SI:DEF RIGHT-BRACKET
	RIGHT-BRACKET
	SINGLE)

(SI:DEF ATSIGN
	(SI:U ATSIGN PERCENT)
	SINGLE)

(SI:DEF COMMA
	COMMA
	SINGLE)

;(SI:DEF PERIOD
;	PERIOD
;        SINGLE)

(SI:DEF SEMI
	SEMI
	SINGLE)

(SI:DEF COLON
	COLON
	SINGLE)

(SI:DEF QUOTED-STRING
	QUOTE-START-CHAR
	START)

(SI:DEF COMMENT
	OPEN
	START)

(SI:DEF CLOSE
	CLOSE
	SINGLE)

(SI:DEF AT-ATOM
	(SI:! AS
	      TS
	      BREAK)
	UNTYI)

(SI:DEF ATOM
	(SI:! (+ (- ANY BREAK))
	      BREAK)
	UNTYI)

(SI:DEF EOF EOF-CHAR SINGLE)

(SI:OPT SI:EOF-CHAR EOF-CHAR)

(SI:OPT SI:QUOTED-CHAR SLASHIFIED-CHAR)

(SI:OPT SI:READ-FUNCTION-PROPERTY 'RFC733)

(SI:OPT SI:WHITE-SPACE-CHAR (CDR WHITE-SPACE-CHAR))

(SI:OPT SI:QUOTE BACKSLASH)

(SI:END RFC733)
